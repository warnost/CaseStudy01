---
title: "Case Study 01"
date: "`r Sys.Date()`"
author: William Arnost and Meisam Alitabarimansor
output:
  rmdformats::readthedown:
    highlight: kate
---


```{r knitr_init, message=FALSE, echo=FALSE, cache=FALSE}
library(knitr)
library(rmdformats) ##This is for the knitr template readthedown
library(tidyverse)  ##This has various data tools
library(kableExtra) ##This is for table formatting
library(Amelia)     ##This is for the missing map
library(naniar)     ##THis is for the pct missing plot
setwd("C:/Users/William/OneDrive/MSDS_6306_DoingDataScience/MSDS_6306_Homework/CaseStudy01")

## Global options
options(max.print="75")
opts_chunk$set(echo=TRUE,
	             cache=TRUE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=75)
```
## 0. EDA
```{r,message=FALSE}
beers <- read_csv("Beers.csv")
breweries <- read_csv("Breweries.csv")
```

We read in two datasets, one which has data on individual beers and another on the names and locations of breweries. 

```{r}
beers_unique_val_count <- sapply(beers, function(x) length(unique(x)))
kable(beers_unique_val_count, col.names = c("Unique Count")) %>% kable_styling(full_width = FALSE)
brew_unique_val_count <- sapply(breweries, function(x) length(unique(x)))
kable(brew_unique_val_count, col.names = c("Unique Count")) %>% kable_styling(full_width = FALSE)
```
Here we are looking at a count of unique values in each column. We can see there are no duplicate beer or brewery IDs, so each row is related to a specific beer or brewery in their respective datasets. It will be good to look at some of the other variables in a bit. 

```{r}
beers_missing_count <- sapply(beers, function(x) sum(is.na(x)))
kable(beers_missing_count, col.names = c("Missing Count")) %>% kable_styling(full_width = FALSE)
brew_missing_count <- sapply(breweries, function(x) sum(is.na(x)))
kable(brew_missing_count, col.names = c("Missing Count")) %>% kable_styling(full_width = FALSE)
```
These tables present a missing count for each variable. The majority of the missing data is in the IBU variable. We will visualize the missing data later on. 

Next we visualize some of the other variables.
```{r,message=FALSE,warning=FALSE}
ggplot(beers, aes(x=ABV)) + geom_histogram() + 
  labs(title = "Distribution of Alcohol by Volume (ABV)", x="Alcohol by Volume", y="Count") +
  theme(legend.position = "none",plot.title = element_text(hjust = 0.5),axis.title.y=element_text(angle=0,vjust=1))
```
This is the distribution of the Alcohol by Volume variable. It has a small right skew.
```{r,message=FALSE,warning=FALSE}
ggplot(beers, aes(x=IBU)) + geom_histogram()
```
The international bitterness unit has a much more skewed distribution. As a reminder it is also missing a lot of data.
```{r}
ggplot(beers, aes(as.character(Ounces))) + geom_bar()
```
There are 7 different sizes of beers in this data set, however most beers either come in 12oz or 16oz sizes. 

```{r}
styles <- beers %>% group_by(Style) %>% summarise(count=n()) %>% arrange(-count)
ggplot(head(styles,10), aes(x=reorder(Style,count), y=count)) + geom_bar(stat="identity") + coord_flip()
```
This plot shows the top 10 styles of beer from the dataset. IPA and Pale Ale are the the two strongest by a fair margin.
```{r}
ggplot(breweries, aes(State)) + geom_bar() + coord_flip()
table(breweries$State)
```
This is a count of breweries by state.

```{r}
combined <- beers %>% left_join(breweries, by = c("Brewery_id" = "Brew_ID"))
byState <- combined %>% select(State, Brewery_id, ABV, IBU) %>% group_by(State) %>% 
  summarise(Brewery_Count = n_distinct(Brewery_id), Median_ABV = median(ABV,na.rm=TRUE), Median_IBU = median(IBU,na.rm=TRUE), Max_ABV = max(ABV,na.rm=TRUE), Max_IBU = max(IBU,na.rm=TRUE))
```
Here we combine the data and create a state level summary to help with further analysis.

## 1. How many breweries are present in each state?
```{r}
ggplot(breweries, aes(State)) + geom_bar() + coord_flip()
table(breweries$State)
```
The chart above shows the number of breweries in each state. Colorado, California, Michigan, Oregon, and Texas has the most breweries.


## 2. Merge beer data with the breweries data. Print the first 6 observations and the last six observations to check the merged file.
```{r}
## We did the merge in the EDA step
head(combined,6)
tail(combined,6)
```
The exact order depends on the procedure, sometimes it applies a sort which changes the top/bottom rows.

## 3.   Report the number of NA's in each column.
```{r}
missmap(combined,y.at=c(1),y.labels = c('') #,
        #col=c('blue','yellow')
        )
gg_miss_var(combined, show_pct=TRUE)
```

## 4.   Compute the median alcohol content and international bitterness unit for each state. Plot a bar chart to compare.
```{r}
ggplot(byState,aes(x=reorder(State,Median_ABV), y=Median_ABV)) + geom_bar(stat="identity") + coord_flip()
ggplot(byState,aes(x=reorder(State,Median_IBU), y=Median_IBU)) + geom_bar(stat="identity") + coord_flip()
```

## 5.   Which state has the maximum alcoholic (ABV) beer? Which state has the most bitter (IBU) beer?
```{r}
byState[which.max(byState$Max_ABV),]
byState[which.max(byState$Max_IBU),]
```

## 6.   Summary statistics for the ABV variable.
```{r}
summary(combined$ABV)
```

## 7.   Is there an apparent relationship between the bitterness of the beer and its alcoholic content? Draw a scatter plot.
```{r}
ggplot(combined,aes(x=IBU,y=ABV)) + geom_point() + geom_smooth(method=lm) 
```
